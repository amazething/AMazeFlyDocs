

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>组装一架满足编队需求的飞机 &mdash; AMazeFlyDocs 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to AMazeFlyDocs’s documentation!" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> AMazeFlyDocs
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">组装一架满足编队需求的飞机</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">系统需求</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">无人机</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">地面控制站</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">一个四轴飞行器的构成：</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">支持电池类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixhack">PixHack飞控板设备接线定义</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">四轴飞行器：</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id8">软件及嵌入式系统配置</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#raspberrypi">RaspberryPI配置参考</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ubuntu-mate-16-04-for-raspberrypi-3b-os">1. 树莓派操作系统(注:本项目采用带有图形界面的Ubuntu MATE 16.04 for RaspberryPI 3B，其他的OS配置方法可能不同)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uartcommunication-interface">2. 将UART启用为communication interface。</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pythonlinux-matepython-2-7">4. 安装Python包和Linux包。（注:mate系统自带python 2.7环境）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ssh">5. 开启ssh。</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xbee">XBee配置参考</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">1. 固件烧写</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">2. 将配置文件导入XBee</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id11">编队程序解析</a></li>
<li class="toctree-l1"><a class="reference internal" href="#license">license</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AMazeFlyDocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>组装一架满足编队需求的飞机</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/formation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>组装一架满足编队需求的飞机<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>系统需求<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>无人机<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>1．使用Pixhawk作为其飞行控制器的无人机。</p>
<p>2．一个微型车载Linux计算机。(例如:树莓派)</p>
<p>3．带有USB适配器的XBee模块。(例如:XBee S1, XBee S2C，等等)</p>
<p>4．(可选)用于调试的USB- ttl适配器(例如FT232,
CP2102/CP2104，不使用PL2303) 示例:XBee模块通过USB连接到RPi,
RPi通过UART连接到Pixhawk。在Rpi上配置硬件UART，使其运行在921600bps
波特率，与Pixhawk系列的设置一致。(<a class="reference external" href="http://ardupilot.org/dev/docs/partner-computers.html">http://ardupilot.org/dev/docs/partner-computers.html</a>)</p>
</div>
<div class="section" id="id4">
<h3>地面控制站<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>1．一个Linux计算机。(虚拟机也可以)</p>
<p>2．带有USB适配器的XBee模块。(如XBee S1, XBee S2C等)
通常一个多旋翼组成包括以下硬件（四轴）：</p>
<div class="figure">
<img alt="" src="_images/picture1.png" />
</div>
</div>
<div class="section" id="id5">
<h3>一个四轴飞行器的构成：<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>四轴机架 X1（必须）</li>
<li>动力马达 X4 （必须）</li>
<li>无刷电子调速器（电调/ESC）X4 （必须）</li>
<li>PixhACK v3 飞控 X1 （必须）</li>
<li>CUAV GPS X1 （必须）</li>
<li>无线数传 (CUAV RADIO/XBEE/XTEND/HACKLINK/WP-LINK） X1对 （必须）</li>
<li>动力电池（必须）</li>
<li>RC遥控器和RC接收机（必须）</li>
<li>无刷云台或者相机（可选）</li>
<li>超声波或者激光传感器（可选）</li>
<li>光流定点传感器（可选）</li>
</ol>
<div class="figure">
<img alt="" src="_images/picture2.jpg" />
</div>
<div class="figure">
<img alt="" src="_images/picture3.jpg" />
</div>
</div>
<div class="section" id="id6">
<h3>支持电池类型<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>使用标配的CUAV IV模块，支持标准2-6V动力电池</p>
<p>IV模块支持2-6V电压、0-60A电流 实时监测</p>
<p>理论上：</p>
<p>需要实时控制能飞行的高度和距离:跟动力续航时间、遥控器或者数传通讯距离有关</p>
<p>自主飞行的高度和距离：跟动力、续航时间有关</p>
</div>
<div class="section" id="pixhack">
<h3>PixHack飞控板设备接线定义<a class="headerlink" href="#pixhack" title="Permalink to this headline">¶</a></h3>
<p>每种飞行器的电动机顺序 (里边的数字对应的飞控板的PWM输出端口)</p>
<p>CW 顺时针螺旋桨，绿色图示</p>
<p>CCW逆时针螺旋桨 ，蓝色图示</p>
<p>注意：错误的接线和固件，都会导致起飞就翻车，或者严重往一边倾斜，需要谨慎安装和选择固件
<img alt="image0" src="_images/picture4.png" /></p>
</div>
<div class="section" id="id7">
<h3>四轴飞行器：<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="" src="_images/picture5.png" />
</div>
<p>这种H型机架，应该配置X型模式</p>
<div class="figure">
<img alt="" src="_images/picture6.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h1>软件及嵌入式系统配置<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>飞控的Telem2接口与RaspberryPI的UART通过3-pin twisted
cable连接，RaspberryPI与XBee(本项目采用XBee pro s1)通过USB
cable相连。为了使三者能够正常通信，须按照以下步骤进行配置。</p>
<div class="section" id="raspberrypi">
<h2>RaspberryPI配置参考<a class="headerlink" href="#raspberrypi" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ubuntu-mate-16-04-for-raspberrypi-3b-os">
<h3>1. 树莓派操作系统(注:本项目采用带有图形界面的Ubuntu MATE 16.04 for RaspberryPI 3B，其他的OS配置方法可能不同)<a class="headerlink" href="#ubuntu-mate-16-04-for-raspberrypi-3b-os" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>SD卡格式化软件SD Formatter 4.0 for SD/SDHC/SDXC</li>
<li>系统镜像文件在Ubuntu mate官网上下载，写入SD卡的软件Win32 Disk Imager</li>
<li>安装操作系统时，勾选开机自动登录。(实现auto-login)</li>
<li>操作系统安装完成以后，下载文本编辑器gedit，方便后续更改配置文件。
sudo apt install gedit</li>
</ol>
</div>
<div class="section" id="uartcommunication-interface">
<h3>2. 将UART启用为communication interface。<a class="headerlink" href="#uartcommunication-interface" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>sudo gedit /boot/cmdline.text</li>
<li>删除语句‘console=serial0,115200’保存并退出。 ### 3.
修改UART配置，关闭蓝牙（注:mate系统默认蓝牙占用UART）</li>
<li>sudo gedit /boot/config.txt</li>
<li>修改init_uart_clock to 16MHz以及init_uart_baudrate to
921600并删除语句前面的注释符号#。（注:飞控Telem2波特率也要相应地修改为921600）</li>
<li>在文本下面添加语句‘core_freq = 250’</li>
<li>在文本下面添加语句‘dtoverlay=pi3-disable-bt’保存并退出</li>
<li>sudo systemctl disable hciuart sudo reboot</li>
</ol>
<p>重启后UART配置完成</p>
</div>
<div class="section" id="pythonlinux-matepython-2-7">
<h3>4. 安装Python包和Linux包。（注:mate系统自带python 2.7环境）<a class="headerlink" href="#pythonlinux-matepython-2-7" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>sudo apt install python-pip python-dev sudo pip install pip dronekit
xbee numpy gps pyzmq –-upgrade</li>
<li>sudo apt install python-serial</li>
</ol>
</div>
<div class="section" id="ssh">
<h3>5. 开启ssh。<a class="headerlink" href="#ssh" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>sudo apt install openssh-server openssh-client</li>
<li>sudo raspi-cofig</li>
<li>出现配置界面，选择‘network’。</li>
<li>选择‘ssh enabled’。 ### 6. 设置开机自启程序。(确保auto-login已实现)</li>
<li>sudo gedit /etc/rc.local</li>
<li>在文件中添加 cd /AmazeFly python onboard.py -xbee /dev/ttyUSB –pix
/dev/ttyAMA0，保存退出</li>
</ol>
</div>
</div>
<div class="section" id="xbee">
<h2>XBee配置参考<a class="headerlink" href="#xbee" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id9">
<h3>1. 固件烧写<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>下载工具XCTU</li>
<li>烧写DigiMesh固件(注:推荐8073 – Xbee DiGiMesh 2.4)</li>
</ol>
</div>
<div class="section" id="id10">
<h3>2. 将配置文件导入XBee<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<div class="section" id="id11">
<h1>编队程序解析<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h1>
<p>AmazeFly的无人机采用<a class="reference external" href="https://pixhawk.org">Pixhawk</a>和<a class="reference external" href="https://www.ardupilot.org">ArduPilot</a>堆栈作为它们的低级飞行控制器，并使用<a class="reference external" href="python.dronekit.io">dronekit-python</a>作为高级应用程序控制。到目前为止还没有在Pixhawk和ArduPilot级别进行修改，所以这个项目完全是用Python编写的，运行在Linux环境下(例如Raspberry
Pi)。</p>
<p>AMazeFly的无人机使用<a class="reference external" href="https://www.digi.com/products/xbee-rf-solutions/2-4-ghz-modules">XBee</a>模块在无人机和地面控制站之间建立高层通信网络。
1.1引用
^^^^^^^
Quan Yuan,Flydan项目(<a class="reference external" href="https://github.com/WeskerYuan/flydan">https://github.com/WeskerYuan/flydan</a>)</p>
<p>AmazeFly项目是Apache 2.0下提供的开源许可。</p>
<p>项目完全是按照<a class="reference external" href="https://google.github.io/styleguide/pyguide.html">谷歌Python风格指南</a>的约定用Python
2.7编写的。</p>
<hr class="docutils" />
<p><img alt="image1" src="_images/picture7.png" /> #### gcs.py</p>
<p>用于四轴飞行器集群控制实验的地面控制站脚本。</p>
<p>该脚本在装有Linux
的笔记本电脑上运行。该过程应连接一个高级XBee模块，用于无人机和地面控制站之间的相互通信。XBee模块运行在API2，转义字符模式。在编写时，应使用XBee
Pro S1模块（使用DIJI
Mesh固件）。有关更多详细信息，请参阅DIJI官方网站和数据表。目前，dronekit
API包支持Python
2.7。然而，Ubuntu是更好的选择，因为它使用‘apt’方式来获得分布式包。</p>
<p>这是四轴飞行器集群控制实验的主要脚本。</p>
<p>该脚本在板载配套计算机（例如Raspberry Pi）上运行。与此同时，
控制通过USB或串行连接，按照MAVLink协议执行。无人驾驶飞机和地面控制站之间，应连接高级XBee模块以进行相互通信。XBee模块在API2，转义字符模式下运行。在编写时，应使用XBee
Pro S1模块（使用DIJI
Mesh固件）。有关更多详细信息，请参阅DIJI官方网站和数据表。目前，dronekit
API包支持Python
2.7。然而，Ubuntu是更好的选择，因为它使用‘apt’方式来获得分布式包。</p>
<p>通信的类和函数。</p>
<p>该模块包含用于车辆或车辆和GCS之间通信的类和函数。通常，使用XBee模块让车辆交换信息。</p>
<p>多代理系统控制算法模块。</p>
<p>此模块包含高级代理系统控制的类和函数。这有两种主要的集群控制算法：
2014年COLLMOT的自动推进算法和2016年的RCSNS的分散式模型预测控制。</p>
<p>导航功能。</p>
<p>该模块包含基本的直升机导航功能，这些功能大部分处于GUIDED模式。这些代码是参考Dronekit组编写的导航功能，借鉴修改来的。</p>
<p>跨文件共享的模块。</p>
<p>该模块包含许多不同的全局共享文件功能。它们是常量或预定义对象，具体取决于具体情况。某些属性在程序启动时被加载或实例化，并且在整个运行过程中都认为是常量。详细说明请参阅源代码注释。</p>
<p>实用功能。</p>
<p>该模块具有几个有用的功能，便于矢量计算和数据日志记录。大多数函数可以直接使用而不需要其他模块。</p>
<p>上传任务。</p>
<p>打开或关闭无人机上的LED。</p>
<p>Mission_txt： 存放任务的目录。</p>
<p>1.建立一个飞行任务，并将生成的任务TXT文件复制到无人机项目中。</p>
<p>2.运行onboard.py文件。</p>
<p>3.在Linux计算机运行gcs.py文件并控制无人机。</p>
<p>软件:APM Planner 2.0</p>
<p>步骤:</p>
<p>(1)运行该软件。</p>
<p>(2)单击“FLIGHT PLAN”。</p>
<div class="figure">
<img alt="picture8" src="_images/picture8.png" />
</div>
<p>(3)双击地图上的一个点(编号为0)作为“飞行原点”。</p>
<div class="figure">
<img alt="picture9" src="_images/picture9.png" />
</div>
<p>(4)双击地图上的第二点(编号为1)作为“起飞点”。</p>
<div class="figure">
<img alt="picture10" src="_images/picture10.png" />
</div>
<div class="figure">
<img alt="picture11" src="_images/picture11.png" />
</div>
<p>(5)继续双击一些点作为路径点。</p>
<div class="figure">
<img alt="picture12" src="_images/picture12.png" />
</div>
<p>(6)可以在页面下方更改点的高度、精确度和标题。</p>
<div class="figure">
<img alt="picture13" src="_images/picture13.png" />
</div>
<p>(7)将生成的TXT文件复制到mission_txt目录中，并按照无人机的序号进行划分。(TXT文件的名称必须是’FIRST
.txt’、’SECOND.txt’或’THIRD.txt’。)</p>
<p>参考:<a class="reference external" href="http://ardupilot.org/planner2/">http://ardupilot.org/planner2/</a></p>
<p>‘onboard.py’脚本会在无人机启动时自动运行。</p>
<p>(1)打开Linux。</p>
<p>(2)将Xbee模块连接到Linux计算机。</p>
<p>(3)运行终端。</p>
<p>(4)使用’cd’命令切换到项目目录。</p>
<p>(5)通过’ sudo python gcs.py -xbee /dev/ttyUSB0
‘运行的’gcs.py’。使用’–help’或参考源代码的文档字符串以获得详细的脚本参数。</p>
<p>(6)控制台将开始提示一些信息。相应地输入字母以执行特定的操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Keylist</span><span class="p">:</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># switch the mode to auto</span>
    <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># the first mission</span>
    <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># the second mission</span>
    <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># the third mission</span>
    <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># landed</span>
    <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># turn on the LED</span>
    <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># kill thread and restart</span>
</pre></div>
</div>
<p>正常起飞顺序应该是:</p>
<p>1).按“1”/“2”/“3”，选择第一/第二/第三个任务。</p>
<p>2).按“x”键，切换到自动模式并起飞。</p>
<p>3).按“d”键，打开LED灯。</p>
<p>4).按“l ”键，直接降落无人机。</p>
<p>5).按“k”键，关闭线程并重新启动。</p>
</div>
<div class="section" id="license">
<h1>license<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://creativecommons.org/licenses/by/4.0/deed.zh">License BY CC
4.0</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to AMazeFlyDocs’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright AMaze

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>